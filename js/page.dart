import 'dart:html';
import 'dart:js' as JS;
import 'dart:convert' as Convert;
import '../lib/json_to_dart.dart';

void main() {
  final convertButton = document.querySelector('button');
  final textArea = document.querySelector('textarea');
  final dartCode = document.querySelector('pre code.dart');
  final CheckboxInputElement usePrivateFieldsCheckbox = document.querySelector('#private-fields');
  convertButton.onClick.listen((MouseEvent event) {
    var syntaxError = false;
    final json = textArea.value;
    try {
      Convert.JSON.decode(json);
    } catch (e) {
      syntaxError = true;
      window.alert('The json provider has syntax errors');
    }
    if (!syntaxError) {
      final modelGenerator = new ModelGenerator('Autogenerated', usePrivateFieldsCheckbox.checked);
      var dart = modelGenerator.generateDartClasses(json);
      dartCode.text = dart;
      JS.context['hljs'].callMethod('highlightBlock', [dartCode]);
    }
  });
}